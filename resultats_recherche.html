<!doctype html>
<html lang="fr">
	<head>
		<meta charset="utf-8">
		<title>Recherche</title>
		<script src="jquery.js"></script>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
		<link rel="stylesheet" href="style.css">
		
	</head>
	<body>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>



<!--//////////AUTRE TEST ////////////////// 
-->
<script>
/*
test à appeler à chaque actualisation de la page + a chaque recherhce
*/
function test(){
	title = document.getElementById('title').value;

	if (title) {
		title = title.replace(' ', '+');
	} else {
		title = getParameterByName('nomfilm');
	}
	
	alert(title);
	
	//recherche par titre
	$.ajax({
		url: 'https://api.themoviedb.org/3/search/movie?api_key=f774f8141b6f19c0d40cca605a071a08&query='+title,
		success: function(res) {
			alert(res.results[0].original_title);
			affichage_resultat(res.results);
			console.log(res);
		},
		error: function(res) {
			alert('problems');
			console.log(res);
		}
	});
}


function affichage_resultat(tab_resultat)
{
	var size = tab_resultat.length;
	alert(size);
	alert(tab_resultat[0]);
	table = '';
	for (i=0; i < size; i++){
		table += '<tr><td>'+tab_resultat[i].original_title+'</td><td>'+tab_resultat[i].genre_ids[0]+'</td><td>'+tab_resultat[i].release_date+'</td><td>'+tab_resultat[i].overview+'</td></tr>'
	}
	document.getElementById('tbody').innerHTML = table;
}


function getParameterByName(name, url) {
	if (!url) url = window.location.href;
	name = name.replace(/[\[\]]/g, "\\$&");
	var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
		results = regex.exec(url);
	if (!results) return null;
	if (!results[2]) return '';
	return decodeURIComponent(results[2].replace(/\+/g, " "));
}


</script>

<h1>Ma Cinémathèquedsqgq</h1>
<div id="content">
<h2>Recherche avancée</h2>
<div id="test">
<form class="form-inline" action = '#' method ='GET'>
	<div class="form-group">
	<ul class="nav nav-tabs">
	<li class="nav-item li-item">
		<input class="form-control" type="text" placeholder="Titre" name="nomfilm">
	</li>

	<li class="nav-item dropdown li-item">
	<div class="form-group">
		<select class="form-control" style="height : 35px;">
	<option selected>Open this select menu</option>
	<option value="1">One</option>
	<option value="2">Two</option>
	<option value="3">Three</option>
</select>
	</div>
	</li>

	<li class="nav-item li-item">
		<input class="form-control" type="number" value="Annee" id="example-search-input">
	</li>

	<li class="nav-item li-item">
		<input class="form-control" onclick="test()" type="button" value="Valider">

	</li>
</ul>
</div>

</form>
</div>


<div id="res">
<table class="table table-striped">
	<thead>
		<tr>
			<th>Titre</th>
			<th>Catégorie</th>
			<th>Année</th>
			<th>Description</th>
		</tr>
	</thead>
	<tbody id='tbody'>
	</tbody>
</table>
</div>

	</body>
</html>
